{"version":3,"file":"commonHelpers.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nexport class PIXABAY_API {\n  static PAGE_SIZE = 60;\n  constructor() {\n    this.BASE_URL = 'https://pixabay.com/api/';\n    this.END_POINT = '';\n    this.query = null;\n    this.page = 1;\n    this.totalHits = 0;\n  }\n  setDefaults() {\n    this.page = 1;\n    this.totalHits = 0;\n  }\n  async getImages() {\n    const params = {\n      q: this.query,\n      image_type: 'photo',\n      key: '42190247-000e45a6447d3626b5dd5a4c9',\n      orientation: 'horizontal',\n      safesearch: true,\n      page: this.page,\n      per_page: PIXABAY_API.PAGE_SIZE,\n    };\n\n    const url = `${this.BASE_URL}${this.END_POINT}?${params}`;\n    const res = await axios.get(url, { params });\n    this.totalHits = res.data.totalHits;\n    return res.data;\n  }\n  isLastPage() {\n    const maxPage = Math.ceil(this.totalHits / PIXABAY_API.PAGE_SIZE);\n    return maxPage <= this.page;\n  }\n}\n","export { renderImage };\n\n// render js\nfunction renderImage(data) {\n  return imagesTemplate(data.hits);\n}\n\nfunction imagesTemplate(images) {\n  return images.map(imageTemplate).join('');\n}\n\nfunction imageTemplate(img) {\n  const {\n    largeImageURL,\n    likes,\n    views,\n    webformatURL,\n    tags,\n    comments,\n    downloads,\n  } = img;\n\n  return `<li class=\"gallery-item\">\n    <a class=\"link-item\" href=\"${largeImageURL}\"><img class=\"gallery-img\" src=\"${webformatURL}\" alt=\"${tags}\" title=\"\"/></a>\n      <div class=\"info\">\n        <p class=\"info-item\"><b>Likes</b><br>${likes}</p>\n        <p class=\"info-item\"><b>Views</b><br>${views}</p>\n        <p class=\"info-item\"><b>Comments</b><br>${comments}</p>\n        <p class=\"info-item\"><b>Downloads</b><br>${downloads}</p>\n      </div>\n    </li>`;\n}\n","import SimpleLightbox from 'simplelightbox';\nimport iziToast from 'izitoast';\nimport { PIXABAY_API } from './js/pixabay-api';\nimport { renderImage } from './js/render-functions.js';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst pixabay_api = new PIXABAY_API();\n\nconst gallerySimpleLightbox = new SimpleLightbox('.js-gallery a.link-item', {\n  /* options */\n  navText: ['←', '→'],\n  closeText: '×',\n  enableKeyboard: true,\n  captionsData: 'alt',\n  captionPosition: 'bottom',\n  captionDelay: 250,\n});\nconst refs = {\n  formEl: document.querySelector('.js-search-form[data-id=\"1\"]'),\n  listEl: document.querySelector('.js-gallery'),\n  inputEl: document.querySelector('.js-input'),\n  loaderEl: document.querySelector('.js-loader'),\n  btnLoader: document.querySelector('#js-btn-load'),\n  targetElem: document.querySelector('#observer'),\n};\n\nrefs.formEl.addEventListener('submit', formSubmit);\nrefs.btnLoader.addEventListener('click', onLoaderMoreClick);\n\nasync function formSubmit(e) {\n  e.preventDefault();\n\n  clearGallery();\n\n  pixabay_api.setDefaults();\n\n  let imgName = e.target.elements.query.value;\n  imgName = imgName ? imgName.trim() : '';\n  if (imgName === '') {\n    showLoadBtnIfNeeded();\n    showError('Enter correct data!');\n    return;\n  }\n\n  pixabay_api.query = imgName;\n\n  clearInput();\n\n  loadImages();\n}\n\nasync function onLoaderMoreClick(e) {\n  if (e) {\n    e.preventDefault();\n  }\n  pixabay_api.page += 1;\n  if (e && e.target.id === 'js-btn-load') {\n    loadImages();\n  }\n}\n\nasync function loadImages() {\n  refs.loaderEl.style.display = 'block';\n\n  try {\n    const searchData = await pixabay_api.getImages();\n    if (searchData.hits.length === 0) {\n      showError('no data on your search query');\n      return;\n    }\n\n    const markup = await renderImage(searchData);\n    refs.listEl.innerHTML += markup;\n\n    gallerySimpleLightbox.refresh();\n    showLoadBtnIfNeeded();\n    checkEndOfCollection();\n  } catch (error) {\n    showError('An error occurred. Please try again later.');\n  } finally {\n    refs.loaderEl.style.display = 'none';\n  }\n  observerCkeckedLastPage();\n}\n\nfunction clearGallery() {\n  refs.listEl.innerHTML = '';\n}\nfunction clearInput() {\n  refs.inputEl.value = null;\n}\nfunction showError(error) {\n  iziToast.error({\n    message: error,\n  });\n}\n\nfunction showMessage(msg) {\n  iziToast.info({\n    message: msg,\n  });\n}\n\nfunction checkEndOfCollection() {\n  if (pixabay_api.isLastPage()) {\n    showMessage(`We're sorry, but you've reached the end of search results.`);\n  }\n}\n\nfunction showLoadBtnIfNeeded() {\n  if (pixabay_api.isLastPage()) {\n    refs.btnLoader.classList.add('hidden');\n  } else {\n    refs.btnLoader.classList.remove('hidden');\n  }\n}\n\nfunction observerCkeckedLastPage() {\n  if (pixabay_api.isLastPage()) observer.unobserve(refs.targetElem);\n}\n\nconst options = {\n  root: document.querySelector('#scrollArea'),\n  rootMargin: '0px',\n  threshold: 1.0,\n};\nconst callback = function (entries, observer) {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      onLoaderMoreClick();\n      observerCkeckedLastPage();\n    }\n  });\n};\nconst observer = new IntersectionObserver(callback, options);\n\nobserver.observe(refs.targetElem);\n"],"names":["_PIXABAY_API","params","url","res","axios","__publicField","PIXABAY_API","renderImage","data","imagesTemplate","images","imageTemplate","img","largeImageURL","likes","views","webformatURL","tags","comments","downloads","pixabay_api","gallerySimpleLightbox","SimpleLightbox","refs","formSubmit","onLoaderMoreClick","clearGallery","imgName","showLoadBtnIfNeeded","showError","clearInput","loadImages","searchData","markup","checkEndOfCollection","observerCkeckedLastPage","error","iziToast","showMessage","msg","observer","options","callback","entries","entry"],"mappings":"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"}